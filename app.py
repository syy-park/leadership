import streamlit as st
import google.generativeai as genai
import os

# --- Gemini APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ë”ì‹­ íŠ¹ì„±ì„ ìš”ì•½í•˜ëŠ” í•¨ìˆ˜ ---
def summarize_leadership_with_gemini(api_key, strengths_text, weaknesses_text):
    """Gemini AI ëª¨ë¸ì„ í˜¸ì¶œí•˜ì—¬ ë¦¬ë”ì‹­ ê°•ì /ì•½ì  í…ìŠ¤íŠ¸ë¥¼ 3ì¤„ë¡œ ìš”ì•½í•˜ëŠ” í•¨ìˆ˜"""
    try:
        # API í‚¤ ì„¤ì •
        genai.configure(api_key=api_key)
        
        # ì‚¬ìš©í•  ëª¨ë¸ ì„ íƒ
        model = genai.GenerativeModel(
            model_name="gemini-1.5-flash", # ë¹ ë¥´ê³  íš¨ìœ¨ì ì¸ ëª¨ë¸
            system_instruction="ë‹¹ì‹ ì€ ë¦¬ë”ì‹­ì„ ì •í™•í•˜ê²Œ ë¶„ì„í•˜ê³  í‰ê°€í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
        )

        # AIì—ê²Œ ì „ë‹¬í•  í”„ë¡¬í”„íŠ¸(ì§€ì‹œë¬¸) êµ¬ì„±
        prompt = f"""
        ì•„ë˜ì— ì œì‹œëœ ë¦¬ë”ì˜ 'ê°•ì 'ê³¼ 'ì•½ì 'ì— ëŒ€í•œ ì˜ê²¬ì„ ë°”íƒ•ìœ¼ë¡œ, ë¦¬ë”ì‹­ íŠ¹ì„±ì„ 3ì¤„ë¡œ ìš”ì•½í•´ì¤˜.

        **ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ê·œì¹™:**
        1.  ê²°ê³¼ëŠ” ë°˜ë“œì‹œ 3ê°œì˜ ë¬¸ì¥ìœ¼ë¡œë§Œ êµ¬ì„±ë˜ì–´ì•¼ í•¨.
        2.  ê° ë¬¸ì¥ì€ 12ë‹¨ì–´ ì´í•˜ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•´ì•¼ í•¨.
        3.  ê° ë¬¸ì¥ì€ ë°˜ë“œì‹œ '~í•¨' ë˜ëŠ” '~ì„'ìœ¼ë¡œ ëë‚˜ì•¼ í•¨.
        4.  ì²« ë¬¸ì¥ì€ ê°•ì , ë‘ ë²ˆì§¸ ë¬¸ì¥ì€ ì•½ì , ì„¸ ë²ˆì§¸ ë¬¸ì¥ì€ ì¢…í•©ì ì¸ í‰ê°€ë¥¼ ë‹´ì•„ì•¼ í•¨.
        5.  ë‹¤ë¥¸ ì„¤ëª… ì—†ì´, ìš”ì•½ëœ 3ê°œì˜ ë¬¸ì¥ë§Œ ì¶œë ¥í•´ì•¼ í•¨.

        ---
        [ê°•ì  ì˜ê²¬]
        {strengths_text}

        [ì•½ì  ì˜ê²¬]
        {weaknesses_text}
        ---
        """

        # AI ëª¨ë¸ë¡œë¶€í„° ë‹µë³€ ìƒì„± ìš”ì²­
        response = model.generate_content(prompt)
        
        # ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜
        summary_lines = response.text.strip().split('\n')
        
        # 3ì¤„ì´ ì•„ë‹ ê²½ìš° ì˜ˆì™¸ì²˜ë¦¬
        if len(summary_lines) != 3:
            return ["AI ëª¨ë¸ì´ í˜•ì‹ì— ë§ê²Œ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„± í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."]

        return summary_lines

    except Exception as e:
        # API í‚¤ ì˜¤ë¥˜ë‚˜ ë‹¤ë¥¸ ì˜ˆì™¸ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        return [f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}", "API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.", "ë‚´ìš©ì„ ë‹¤ì‹œ í™•ì¸ í›„ ì‹œë„í•´ì£¼ì„¸ìš”."]


# --- Streamlit UI êµ¬ì„± ---

# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="AI ë¦¬ë”ì‹­ íŠ¹ì„± ìš”ì•½ê¸°", page_icon="ğŸ‘¨â€ğŸ’¼", layout="wide")

# ì‚¬ì´ë“œë°”ì— API í‚¤ ì…ë ¥ í•„ë“œ ì¶”ê°€
with st.sidebar:
    st.header("ğŸ”‘ API í‚¤ ì„¤ì •")
    gemini_api_key = st.text_input("Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", type="password")
    st.markdown("[API í‚¤ ë°œê¸‰ë°›ê¸°](https://aistudio.google.com/app/apikey)")
    st.info("ì…ë ¥í•˜ì‹  API í‚¤ëŠ” ì„œë²„ì— ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ìƒˆë¡œê³ ì¹¨ ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.")

# ë©”ì¸ í™”ë©´ êµ¬ì„±
st.title("ğŸ‘¨â€ğŸ’¼ AI ë¦¬ë”ì‹­ íŠ¹ì„± 3ì¤„ ìš”ì•½")
st.write("ë¦¬ë”ì˜ ê°•ì ê³¼ ì•½ì ì— ëŒ€í•œ ì˜ê²¬ì„ ì…ë ¥í•˜ë©´, Gemini AIê°€ í•µì‹¬ íŠ¹ì„±ì„ 3ì¤„ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.")
st.write("")

# ì…ë ¥ í•„ë“œ (ë‘ ê°œì˜ ì»¬ëŸ¼ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë°°ì¹˜)
col1, col2 = st.columns(2)
with col1:
    strengths_input = st.text_area("ğŸ‘ **ê°•ì ** ë˜ëŠ” **ì¹­ì°¬í•  ì **ì„ ìƒì„¸íˆ ì…ë ¥í•˜ì„¸ìš”.", placeholder="ì˜ˆ: íŒ€ì›ë“¤ì˜ ì˜ê²¬ì„ í•­ìƒ ê²½ì²­í•˜ê³  ì¡´ì¤‘í•˜ë©°, ëª…í™•í•œ ë¹„ì „ê³¼ ë°©í–¥ì„±ì„ ì œì‹œí•´ì¤ë‹ˆë‹¤. ìœ„ê¸° ìƒí™©ì—ì„œë„ ì¹¨ì°©í•˜ê²Œ íŒ€ì„ ì´ëŒì–´ ì‹ ë¢°ë¥¼ ì¤ë‹ˆë‹¤.", height=200)

with col2:
    weaknesses_input = st.text_area("ğŸ‘ **ì•½ì ** ë˜ëŠ” **ê°œì„ ì **ì„ ìƒì„¸íˆ ì…ë ¥í•˜ì„¸ìš”.", placeholder="ì˜ˆ: ë•Œë¡œëŠ” ì—…ë¬´ ìœ„ì„ë³´ë‹¤ ì§ì ‘ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬í•˜ë ¤ëŠ” ê²½í–¥ì´ ìˆì–´ íŒ€ì›ë“¤ì˜ ì„±ì¥ì„ ì €í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°ì •ëœ ì‚¬í•­ì— ëŒ€í•œ í”¼ë“œë°±ì´ ì¡°ê¸ˆ ë” ë¹ ë¥´ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.", height=200)

# ìš”ì•½ ì‹¤í–‰ ë²„íŠ¼
if st.button("âœ¨ AIë¡œ ìš”ì•½í•˜ê¸°", type="primary"):
    # 1. API í‚¤ê°€ ìˆëŠ”ì§€ í™•ì¸
    if not gemini_api_key:
        st.error("â— ì‚¬ì´ë“œë°”ì— Gemini API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.")
    # 2. ê°•ì /ì•½ì  ë‚´ìš©ì´ ëª¨ë‘ ìˆëŠ”ì§€ í™•ì¸
    elif not strengths_input or not weaknesses_input:
        st.error("â— ê°•ì ê³¼ ì•½ì  ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    # 3. ëª¨ë“  ì¡°ê±´ ì¶©ì¡± ì‹œ AI ìš”ì•½ ì‹¤í–‰
    else:
        with st.spinner('AIê°€ ë¦¬ë”ì‹­ íŠ¹ì„±ì„ ì‹¬ì¸µ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...'):
            summary_results = summarize_leadership_with_gemini(gemini_api_key, strengths_input, weaknesses_input)
            
            st.write("---")
            st.subheader("ğŸ“‹ ë¦¬ë”ì‹­ íŠ¹ì„± ìš”ì•½ ê²°ê³¼")

            # ê²°ê³¼ê°€ 3ì¤„ì¼ ê²½ìš° ì •ìƒ ì¶œë ¥
            if len(summary_results) == 3:
                st.info(f"**ê°•ì  ê¸°ë°˜ íŠ¹ì„±:** {summary_results[0]}")
                st.warning(f"**ë³´ì™„ í•„ìš” íŠ¹ì„±:** {summary_results[1]}")
                st.success(f"**ì¢…í•© í”„ë¡œí•„:** {summary_results[2]}")
            # ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
            else:
                for line in summary_results:
                    st.error(line)
